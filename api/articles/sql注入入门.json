{"title":"sql注入入门","uid":"b7ab690037a7c2d44c2d4405477467f3","slug":"sql注入入门","date":"2023-09-03T01:18:09.000Z","updated":"2023-09-03T12:12:05.518Z","comments":true,"path":"api/articles/sql注入入门.json","keywords":null,"cover":"/images/1.png","content":"<div class=\"custom-quote tip\">\n<span class=\"custom-quote-svg\"><svg width=\"24\" height=\"24\" viewBox=\"0 0 24 24\" fill=\"\" xmlns=\"http://www.w3.org/2000/svg\" data-reactroot=\"\">\n<path fill=\"\" d=\"M20.86 14.13C20 14.7 19.56 15.74 19.77 16.76C20.13 18.55 18.55 20.13 16.76 19.77C15.74 19.57 14.7 20 14.13 20.86C13.12 22.38 10.89 22.38 9.88 20.86C9.3 20 8.26 19.56 7.24 19.77C5.45 20.13 3.87 18.55 4.23 16.76C4.43 15.74 4 14.7 3.14 14.13C1.62 13.12 1.62 10.89 3.14 9.88C4 9.3 4.44 8.26 4.23 7.24C3.87 5.45 5.45 3.87 7.24 4.23C8.26 4.44 9.3 4 9.87 3.14C10.88 1.62 13.11 1.62 14.12 3.14C14.7 4 15.74 4.44 16.76 4.23C18.55 3.87 20.13 5.45 19.77 7.24C19.56 8.26 20 9.3 20.86 9.87C22.38 10.88 22.38 13.12 20.86 14.13Z\" undefined=\"1\"></path>\n<path stroke-linejoin=\"round\" stroke-linecap=\"round\" stroke-miterlimit=\"10\" stroke-width=\"2\" stroke=\"\" d=\"M12.01 15C12.01 14.5 12.01 14.5 12.01 14.5C12.04 13.75 13 13.46 14.04 12.2C14.41 11.74 14.69 11.41 14.86 10.85C15.15 9.95 14.92 9.18 14.86 9.02C14.8 8.79 14.52 8 13.72 7.46C13.06 7.02 12.42 7 12.14 7C11.9 7 11.36 7 10.78 7.3C10.28 7.56 9.98 7.9 9.83 8.1C9.24 8.82 9.06 9.63 9 10.06\"></path>\n<path stroke-linecap=\"round\" stroke-miterlimit=\"10\" stroke-width=\"2\" stroke=\"\" d=\"M11.99 18H12.01\"></path>\n</svg></span>\n<p class=\"custom-quote-title\"> 1.什么是sql注入</p>\n<p><p>SQL注入即是指web应用程序对用户输入数据的合法性没有判断或过滤不严，<br>攻击者可以在web应用程序中事先定义好的查询语句的结尾上添加额外的SQL语句，<br>在管理员不知情的情况下实现非法操作，<br>以此来实现欺骗数据库服务器执行非授权的任意查询，<br>从而进一步得到相应的数据信息。</p>\n</p>\n</div>\n<div class=\"custom-quote warning\">\n<span class=\"custom-quote-svg\"><svg width=\"24\" height=\"24\" viewBox=\"0 0 24 24\" fill=\"\" xmlns=\"http://www.w3.org/2000/svg\" data-reactroot=\"\">\n<path fill=\"\" d=\"M20.86 14.13C20 14.7 19.56 15.74 19.77 16.76C20.13 18.55 18.55 20.13 16.76 19.77C15.74 19.57 14.7 20 14.13 20.86C13.12 22.38 10.89 22.38 9.88 20.86C9.3 20 8.26 19.56 7.24 19.77C5.45 20.13 3.87 18.55 4.23 16.76C4.43 15.74 4 14.7 3.14 14.13C1.62 13.12 1.62 10.89 3.14 9.88C4 9.3 4.44 8.26 4.23 7.24C3.87 5.45 5.45 3.87 7.24 4.23C8.26 4.44 9.3 4 9.87 3.14C10.88 1.62 13.11 1.62 14.12 3.14C14.7 4 15.74 4.44 16.76 4.23C18.55 3.87 20.13 5.45 19.77 7.24C19.56 8.26 20 9.3 20.86 9.87C22.38 10.88 22.38 13.12 20.86 14.13Z\" undefined=\"1\"></path>\n<path stroke-linejoin=\"round\" stroke-linecap=\"round\" stroke-miterlimit=\"10\" stroke-width=\"2\" stroke=\"\" d=\"M12 8V13\"></path>\n<path stroke-linejoin=\"round\" stroke-linecap=\"round\" stroke-miterlimit=\"10\" stroke-width=\"2\" stroke=\"\" d=\"M12 15.99V16.01\"></path>\n</svg>\n</span>\n<p class=\"custom-quote-title\">2.常见数据库端口号</p>\n<p>    关系型数据库：<br>        1.Oracle数据库默认端口号为，1521；<br>        2.MySQL数据库默认端口号为，3306；<br>        3.SQLServer数据库默认端口号为，1433;<br>        4.postgreSQL数据库默认端口号为，5432;<br>    NOSQL数据库：<br>        1.MongoDB默认端口号为：27017；<br>        2.Redis默认端口号为：6379；<br>        3.memcached默认端口号为：11211；</p>\n</div>\n<div class=\"custom-quote warning\">\n<span class=\"custom-quote-svg\"><svg width=\"24\" height=\"24\" viewBox=\"0 0 24 24\" fill=\"\" xmlns=\"http://www.w3.org/2000/svg\" data-reactroot=\"\">\n<path fill=\"\" d=\"M20.86 14.13C20 14.7 19.56 15.74 19.77 16.76C20.13 18.55 18.55 20.13 16.76 19.77C15.74 19.57 14.7 20 14.13 20.86C13.12 22.38 10.89 22.38 9.88 20.86C9.3 20 8.26 19.56 7.24 19.77C5.45 20.13 3.87 18.55 4.23 16.76C4.43 15.74 4 14.7 3.14 14.13C1.62 13.12 1.62 10.89 3.14 9.88C4 9.3 4.44 8.26 4.23 7.24C3.87 5.45 5.45 3.87 7.24 4.23C8.26 4.44 9.3 4 9.87 3.14C10.88 1.62 13.11 1.62 14.12 3.14C14.7 4 15.74 4.44 16.76 4.23C18.55 3.87 20.13 5.45 19.77 7.24C19.56 8.26 20 9.3 20.86 9.87C22.38 10.88 22.38 13.12 20.86 14.13Z\" undefined=\"1\"></path>\n<path stroke-linejoin=\"round\" stroke-linecap=\"round\" stroke-miterlimit=\"10\" stroke-width=\"2\" stroke=\"\" d=\"M12 8V13\"></path>\n<path stroke-linejoin=\"round\" stroke-linecap=\"round\" stroke-miterlimit=\"10\" stroke-width=\"2\" stroke=\"\" d=\"M12 15.99V16.01\"></path>\n</svg>\n</span>\n<p class=\"custom-quote-title\">常用的函数有:</p>\n<p><pre class=\"line-numbers language-none\"><code class=\"language-none\">version(),user(),database(),@@version_complie_os\ngroup_concat(table_name);&#x2F;&#x2F;主要用来将查询到的表全部拼接\t\ninformation_schema主要用的表有TABLES和SCHEMAS，列有CLOUNM_NAME,TABLE_NAME,SCHEMA_NAME</code></pre>\n</p>\n</div>\n<div class=\"custom-quote danger\">\n<span class=\"custom-quote-svg\"><svg width=\"24\" height=\"24\" viewBox=\"0 0 24 24\" fill=\"\" xmlns=\"http://www.w3.org/2000/svg\" data-reactroot=\"\">\n<path fill=\"\" d=\"M19.76 5.23C15.84 5.23 12 2 12 2C12 2 8.15996 5.23 4.23996 5.23C4.23996 5.23 1.86996 16.99 12 22C22.13 16.99 19.76 5.23 19.76 5.23Z\" undefined=\"1\"></path>\n<path stroke-linejoin=\"round\" stroke-linecap=\"round\" stroke-miterlimit=\"10\" stroke-width=\"2\" stroke=\"\" d=\"M12 8V13\"></path>\n<path stroke-linejoin=\"round\" stroke-linecap=\"round\" stroke-miterlimit=\"10\" stroke-width=\"2\" stroke=\"\" d=\"M11.99 16H12\"></path>\n</svg>\n</span>\n<p class=\"custom-quote-title\">3.sql注入有哪些</p>\n<p><strong>http-head注入</strong><br><strong>json注入</strong><br><strong>联合注入</strong><br><strong>编码解码注入</strong><br><strong>加密解密注入</strong></p>\n<p><strong>报错注入</strong></p>\n<pre class=\"line-numbers language-none\"><code class=\"language-none\">*floor函数\n\tfloor和count和group by三个函数在一起会产生报错。\n\t语句：select * from aaa where id&#x3D;1 and (select 1 from \n\t\t(select count(*),concat(user(),floor(rand(0)*2))x from information_schema.tables group by x)a);\n\n*extractValue函数\n\t*原理和updatexml一样。\n\t*语句：select * from aaa where id&#x3D;1 and (extractvalue(1,concat(0x7e,(select user()),0x7e)));\n*updatexml函数\n\t*updatexml(XML_document, XPath_string, new_value);\n\n\t简单来说就是updatexml(目标xml内容,xml文档路径,更新的内容)\n\t我们在xml文档路径的位置写入了子查询，和特殊字符拼接在一起，因为不符合输入路径规则然后报错，\n\t先执行了子查询我们可以得到库名。0x7e是16进制里面的“~”，是一个特殊符号，不符合路径规则报错\n\t语句：select &#39;*&#39; from aaa where id&#x3D;1 and updatexml(1,concat(0x7e,(select user()),1)</code></pre>\n<p><strong>布尔注入</strong></p>\n<pre class=\"line-numbers language-none\"><code class=\"language-none\">利用场景：有些网站没有输出点，且关闭了错误回显，但明显的返回true或者false。\t\n\t这里以mysql为例，需要用到的几个函数。\n\tlength()：函数的返回值为字符串的字节长度。\n\tsubstr()：截取字符串，用法substr(string, start,length)\n\tstring-指定的要截取的字符串  start-规定在字符串的何处开始 length-指定要截取的字符串长度\n\tascii()：返回字符串中第一个字符的ascii值\n\t1：使用length()函数猜数据库名长度\n\t\t如length(database())&gt;10,页面显示正常。\n\t\tlength(database())&gt;20,页面显示不正常。\n\t\tlength(database())&#x3D;9,页面显示正常。\n\t我们可以用二分法猜解得到数据库的长度。\n\t2：利用ascii猜数据库名\n\t\tand (ascii(substr(database(),1,1)))&#x3D;100,如果页面返回正常，说明数据库名称第一位是d\n\t3：猜字段名\n\t\tand (ascii(substr((select column_name from \n\t\tinformation_schema.columns where table_name&#x3D;&#39;aaa&#39; limit 0,1),1,1)))&gt;100</code></pre>\n\n<p><strong>延时注入</strong></p>\n<pre class=\"line-numbers language-none\"><code class=\"language-none\">有时候我们会遇到一种情况，无论怎么操作页面都是返回正常，这时我们可以考虑用延时注入。\n\n这里用mysql举例，需要用到两个函数。\nsleep()：执行挂起一段时间,也就是等待一段时间在继续执行。\n例：select  * from  users where id&#x3D;1 and sleep(5);   &#x2F;* 5秒之后执行SQL语句*&#x2F;\nif(expr1,expr2,expr3)：expr1为0或者null或者false，则返回 expr3 ; 否则，返回expr2。\n构造语句：and if(ascii(substr(database(),1,1))&#x3D;100,0,sleep(10))\n如果库名第一个字符是d，则网页延时10秒。</code></pre>\n<p><strong>宽字节注入</strong></p>\n<pre class=\"line-numbers language-none\"><code class=\"language-none\">原理：\n\t如果程序设计数据库编码的时候设置了非英文编码，php发送请求到mysql时经过一次gbk编码，因为gbk是双字节编码，\n\t当设置gbk编码后，遇到了连续两个字节都符合gbk取值范围，会自动解析成一个汉字，输入%df%27，本来\\会转义%27（’）,\n\t但\\（%5c）的编码数为92，%df的编码数为223，符合取值范围，于是%df%5c会解析成为一个汉字“運”，单引号就逃逸了出来，\n\t从而绕过转义造成注入。\n\n\t注：1.POST注入并不会进行URL转码，所以需要改hex。\n\t2.在查询时用到的表名字段名不能用原来的‘admin’形式，这时候可以转换十六进制，或者用子查询。\n\t3.还可以用汉字绕过。</code></pre>\n\n<p><strong>dnslog注入</strong></p>\n<pre class=\"line-numbers language-none\"><code class=\"language-none\">在某些无法直接利用漏洞获得回显时如果用盲注来做效率低下且容易被waf拦截，但是目标可以发起请求，这个时候我们\n可以通过DNS解析把我们想要获得的数据外带出来。\n注入过程：通过子查询将内容拼接到域名内，让load_file()去访问共享文件，访问的域名被记录，读取远程共享文件，\n通过拼接出函数做查询，\n拼接到域名中，访问时将访问服务器，记录后查询该日志。\n\n这里需要用到一个mysql函数LOAD_FILE()：读取一个文件并将其内容作为字符串返回。\nLOAD_FILE(file_name)，file_name是文件的完整路径。\n要使用这个函数，需要满足下面三个条件：\n\t文件必须位于服务器主机上\n\t必须指定完整路径的文件，且必须有FILE权限。\n\t该文件所有字节可读，但文件内容必须小于max_allowed_packet(限制server接受的数据包大小函数，默认1MB)。\n\t该功能不是默认开启的，需要在mysql配置文件加上一句secure_file_priv&#x3D;&#39;&#39;</code></pre>\n\n<p><strong>偏移注入</strong></p>\n<pre class=\"line-numbers language-none\"><code class=\"language-none\">   使用sql注入的时候，我们会遇到一些无法查询表名字段名的时候，比如access数据库没有系统自带库。\n使用场景：当你猜到表名但是无法猜到字段名的情况下可以使用。\n以access数据库为例，假设我们已经通过爆破得到我们要查询的表名为admin\n1.判断字段：\n\t用order by判断一共有15个字段\n2.爆出显示位：\n\tunion select 1,2,3,4,5,6,7,8,9,10,11,12,13,14,15 from admin\n\t假设输出点在3,4,5\n3.偏移注入判断admin表里的字段数为6\n\tunion select 1,2,3,4,5,6,7,8,9,10,11,12,*,14,15 from admin 页面报错\n\tunion select 1,2,3,4,5,6,7,8,9,* from admin 页面正常\n\t*等价于admin.* 表示admin表里面的所有字段\n4.获取字段名\n\t我们假设admin里面的6个字段为a，b，c，d，e，f\n\tunion select 1,2,3,4,5,6,7,8,9,10,11,12,13,14,15 from admin\n\t等价为union select 1,2,3,4,5,6,7,8,9, * from admin\n\t因为输出点在3,4,5那么union select 1,2, *,9,10,11,12,13,14,15 from admin\n\t是不是等于union select 1,2,a,b,c,d,e,f,9,10,11,12,13,14,15 from admin\n\t那么我们就可以得到a，b，c的数据\n\t我们可以继续移动位置union select 1,admin.*,8,9,10,11,12,13,14,15 from admin\n\t这样我们就可以的b，c，d的数据，但是我们怎么也无法得到f的数据，所以偏移注入也是有局限的，\n\t原本要查询的字段数越多，输出点越多，就越有利。</code></pre>\n<p><strong>二次注入</strong></p>\n<pre class=\"line-numbers language-none\"><code class=\"language-none\">二次注入是指已存储（数据库、文件）的用户输入被读取后再次进入到 SQL 查询语句中导致的注入。\n二次注入是sql注入的一种，但是比普通sql注入利用更加困难，利用门槛更高。普通注入数据直接进\n入到 SQL 查询中，而二次注入则是输入数据经处理后存储，取出后，再次进入到 SQL 查询。\n\n原理:\n\t在第一次进行数据库插入数据的时候，仅仅只是使用了 addslashes 或者是借助 get_magic_quotes_gpc \n\t对其中的特殊字符进行了转义，\n\t在后端代码中可能会被转义，但在存入数据库时还是原来的数据，数据中一般带有单引号和＃号，\n\t然后下次使用在拼凑SQL中，所以就形成了二次注入。\n\n过程:\n\t插入1‘#\n\t转义成1\\’#\n\t不能注入，但是保存在数据库时变成了原来的1’#\n\t利用1’#进行注入,这里利用时要求取出数据时不转义\n\t\n换言之, 二次注入需要具备的两个条件：\n\t（1）用户向数据库插入恶意语句（即使后端代码对语句进行了转义，\n\t\t 如mysql_escape_string、mysql_real_escape_string转义）\n\t（2）数据库对自己存储的数据非常放心，直接取出恶意数据给用户</code></pre>\n<p><strong>堆叠注入</strong></p>\n<pre class=\"line-numbers language-none\"><code class=\"language-none\">Stacked injections(堆叠注入)从名词的含义就可以看到应该是一堆 sql 语句(多条)一起执行。\n而在真实的运用中也是这样的, 我们知道在 mysql 中, 主要是命令行中, 每一条语句结尾加;\n表示语句结束。这样我们就想到了是不是可以多句一起使用。这个叫做 stacked  injection。\n\n堆叠注入原理\n\t在SQL中，分号（;）是用来表示一条sql语句的结束。试想一下我们在 ; 结束一个sql语句后继续构造下一条语句，会不会一起执行？\n\t因此这个想法也就造就了堆叠注入。而union injection（联合注入）也是将两条语句合并在一起，两者之间有什么区别么？\n\t区别就在于union 或者union all执行的语句类型是有限的，可以用来执行查询语句，而堆叠注入可以执行的是任意的语句。例如以下这个例子。\n\t用户输入：1; DELETE FROM products服务器端生成的sql语句为： Select * from products where productid&#x3D;1;DELETE FROM products当执行查询后，\n\t第一条显示查询信息，第二条则将整个表进行删除。\n\n堆叠注入的局限性\n\t堆叠注入的局限性在于并不是每一个环境下都可以执行，可能受到API或者数据库引擎不支持的限制，\n\t当然了权限不足也可以解释为什么攻击者无法修改数据或者调用一些程序。</code></pre>\n\n</div>\n","feature":true,"text":" 1.什么是sql注入 SQL注入即是指web应用程序对用户输入数据的合法性没有判断或过滤不严，攻击者可以在web应用程序中事先定义好的查询语句的结尾上添加额外...","link":"","photos":[],"count_time":{"symbolsCount":"5k","symbolsTime":"5 mins."},"categories":[{"name":"sql注入","slug":"sql注入","count":1,"path":"api/categories/sql注入.json"}],"tags":[{"name":"sql注入","slug":"sql注入","count":1,"path":"api/tags/sql注入.json"},{"name":"web安全","slug":"web安全","count":1,"path":"api/tags/web安全.json"},{"name":"入门","slug":"入门","count":1,"path":"api/tags/入门.json"}],"toc":"","author":{"name":"伽啵","slug":"blog-author","avatar":"/images/head.jpg","link":"/","description":"一位信安的大学牲兼ZSQ他爹","socials":{"github":"","twitter":"","stackoverflow":"","wechat":"","qq":"","weibo":"","zhihu":"","csdn":"","juejin":"","customs":{}}},"mapped":true,"hidden":false,"prev_post":{"title":"Hello World","uid":"b9663f58f18133b35bfe243f3e916a80","slug":"hello-world","date":"2023-09-03T02:32:24.363Z","updated":"2023-09-03T07:32:24.628Z","comments":true,"path":"api/articles/hello-world.json","keywords":null,"cover":"/images/3.png","text":"Welcome to Hexo! This is your very first post. Check documentation for more info...","link":"","photos":[],"count_time":{"symbolsCount":440,"symbolsTime":"1 mins."},"categories":[],"tags":[],"author":{"name":"伽啵","slug":"blog-author","avatar":"/images/head.jpg","link":"/","description":"一位信安的大学牲兼ZSQ他爹","socials":{"github":"","twitter":"","stackoverflow":"","wechat":"","qq":"","weibo":"","zhihu":"","csdn":"","juejin":"","customs":{}}}},"next_post":{"title":"须知","uid":"b8293080b39b799f8a79ba4eca1cf5d4","slug":"须知","date":"2023-09-02T11:28:09.000Z","updated":"2023-09-03T12:13:14.505Z","comments":true,"path":"api/articles/须知.json","keywords":null,"cover":"/images/2.png","text":" ZSQ死卷逼我孙子,CS榜首 ","link":"","photos":[],"count_time":{"symbolsCount":24,"symbolsTime":"1 mins."},"categories":[],"tags":[{"name":"须知","slug":"须知","count":1,"path":"api/tags/须知.json"}],"author":{"name":"伽啵","slug":"blog-author","avatar":"/images/head.jpg","link":"/","description":"一位信安的大学牲兼ZSQ他爹","socials":{"github":"","twitter":"","stackoverflow":"","wechat":"","qq":"","weibo":"","zhihu":"","csdn":"","juejin":"","customs":{}}},"feature":true}}